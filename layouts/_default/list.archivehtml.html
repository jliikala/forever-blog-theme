{{ define "main" }}
<div class="archive">
  <h2 class="p-name">Archive</h2>
	{{ $posts := where .Site.RegularPages "Type" "post" }}
    {{ $years := dict }} <!-- Create a dictionary to store posts by year -->

    <!-- Group posts by year -->
    {{ range $posts }}
        {{ $year := .Date.Format "2006" }}
        {{ if not (index $years $year) }}
            {{ $years = $years | merge (dict $year (slice .)) }}
        {{ else }}
            {{ $yearPosts := index $years $year }}
            {{ $yearPosts = $yearPosts | append . }}
            {{ $years = $years | merge (dict $year $yearPosts) }}
        {{ end }}
    {{ end }}

    <!-- Display posts grouped by year -->
    {{ range $years }}
        <h3>{{ .Key }}</h3> <!-- Display the year -->
        {{ range .Value }} <!-- Loop through posts of the current year -->
        <p class="h-entry">
            <a href="{{ .Permalink }}" class="u-url">
                <span class="dt-published" datetime="{{ .Date.Format "2006-01-02T15:04:05-0700" }}">{{ .Date.Format "Jan 2, 2006" }}</span>
            </a>:
            {{ if .Title }}
            <span class="p-name"><b>{{ .Title }}</b></span>
            {{ end }}
            <span class="p-summary">{{ .Summary | truncate 150 }}</span>
        </p>
        {{ end }}
    {{ end }}
</div>

{{ end }}