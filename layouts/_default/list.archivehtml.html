{{ define "main" }}
<div class="archive">
  <h2 class="p-name">Archive</h2>
  {{ $list := ($.Site.GetPage "taxonomyTerm" "categories").Pages }}
    {{ if gt (len $list) 0 }}
    <div class="archive-categories">
      <h3>Categories</h3>
      <ul>
        {{ range $list }}
        {{ $categoryName := .Title }}
        {{ $postCount := len (where $.Site.RegularPages "Params.categories" "intersect" (slice $categoryName)) }}
        {{ if gt $postCount 0 }}
        <li>
          <a href="{{ .Permalink }}">{{ .Title }}</a>
          ({{ $postCount }})
        </li>
        {{ end }}
        {{ end }}
      </ul>
    </div>
    {{ end }}
	<div class="full-archives h-feed">
		<h3>Full Post List</h3>
		{{ $list := (where .Site.Pages "Type" "post") }}
		{{ range $list }}

		<p class="h-entry">
			<a href="{{ .Permalink }}" class="u-url"><span class="dt-published" datetime="{{ .Date.Format "2006-01-02T15:04:05-0700" }}">{{ .Date.Format "Jan 2, 2006" }}</span></a>:
			{{ if .Title }}
			<span class="p-name"><b>{{ .Title }}</b></span>
			{{ end }}
			<span class="p-summary">{{ .Summary | truncate 150 }}</span>
		</p>

		{{ end }}
	</div>
</div>

{{ end }}